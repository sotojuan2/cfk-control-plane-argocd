ðŸ“‹ TAREA 8: Test Workflow with Non-Compliant Resources (Negative Case)
=======================================================================

ðŸŽ¯ OBJETIVO:
Verificar que el workflow de GitHub Actions FALLA correctamente cuando se usan nombres de KafkaTopic que NO CUMPLEN la convenciÃ³n de nombres (^demo-topic-[0-9]+$).

ðŸ“ ESTADO: IN-PROGRESS

ðŸš€ SUBTAREAS Y PASOS DETALLADOS:
===============================

ðŸ”„ SUBTAREA 8.1: Create Test Branch for Negative Case
-----------------------------------------------------
ðŸ“‹ Estado: PENDING

ðŸŽ¯ Objetivo: Crear nueva rama para probar el caso negativo

Comandos a ejecutar:
```bash
# Asegurar que estamos en main y actualizado
git checkout main
git pull origin main

# Crear nueva rama para test negativo
git checkout -b feature/test-invalid-kafka-topic
```

Criterio de aceptaciÃ³n: âœ… Nueva rama creada y activa


ðŸ”„ SUBTAREA 8.2: Develop Non-Compliant KafkaTopic Manifest
----------------------------------------------------------
ðŸ“‹ Estado: PENDING (depende de 8.1)

ðŸŽ¯ Objetivo: Crear manifiestos con nombres INVÃLIDOS

Ejemplos de nombres INVÃLIDOS que violan ^demo-topic-[0-9]+$:
- âŒ "invalid-topic-123" (no empieza con "demo-topic-")
- âŒ "demo-topic-test" (no termina en nÃºmeros)
- âŒ "demo-topic-" (no tiene nÃºmeros al final)
- âŒ "Demo-Topic-123" (mayÃºsculas)
- âŒ "demo_topic_123" (guiones bajos)

Archivos a crear:
```bash
# Crear directorio si no existe
mkdir -p test-resources

# Crear archivo con manifiestos invÃ¡lidos
cat > test-resources/invalid-kafka-topics.yaml << 'EOF'
apiVersion: platform.confluent.io/v1beta1
kind: KafkaTopic
metadata:
  name: invalid-topic-123  # âŒ No empieza con "demo-topic-"
  namespace: confluent
spec:
  replicas: 3
  partitionCount: 6
  configs:
    cleanup.policy: "delete"
---
apiVersion: platform.confluent.io/v1beta1
kind: KafkaTopic
metadata:
  name: demo-topic-test    # âŒ No termina en nÃºmeros
  namespace: confluent
spec:
  replicas: 3
  partitionCount: 6
  configs:
    cleanup.policy: "delete"
---
apiVersion: platform.confluent.io/v1beta1
kind: KafkaTopic
metadata:
  name: demo-topic-        # âŒ No tiene nÃºmeros al final
  namespace: confluent
spec:
  replicas: 3
  partitionCount: 6
  configs:
    cleanup.policy: "delete"
EOF
```

Criterio de aceptaciÃ³n: âœ… Archivo creado con mÃºltiples manifiestos invÃ¡lidos


ðŸ”„ SUBTAREA 8.3: Commit and Push Invalid Manifest to Test Branch
----------------------------------------------------------------
ðŸ“‹ Estado: PENDING (depende de 8.1, 8.2)

ðŸŽ¯ Objetivo: Subir manifiestos invÃ¡lidos a la rama de test

Comandos a ejecutar:
```bash
# Agregar archivo al staging
git add test-resources/invalid-kafka-topics.yaml

# Commit con mensaje descriptivo
git commit -m "test: Add invalid KafkaTopic manifests for negative case testing

- invalid-topic-123: wrong prefix
- demo-topic-test: wrong suffix  
- demo-topic-: missing numbers
These should trigger OPA validation failures"

# Push a rama remota
git push origin feature/test-invalid-kafka-topic
```

Criterio de aceptaciÃ³n: âœ… Cambios subidos a GitHub


ðŸ”„ SUBTAREA 8.4: Open Pull Request for Negative Case Validation
---------------------------------------------------------------
ðŸ“‹ Estado: PENDING (depende de 8.3)

ðŸŽ¯ Objetivo: Crear PR para disparar el workflow

Pasos:
1. Ve a GitHub: https://github.com/sotojuan2/cfk-control-plane-argocd
2. Selecciona la rama: feature/test-invalid-kafka-topic
3. Haz clic en "Compare & pull request"
4. Completa:
   - TÃ­tulo: "Test: Negative Case - Invalid KafkaTopic Naming Convention"
   - DescripciÃ³n: 
     ```
     ðŸ”´ NEGATIVE TEST CASE
     
     This PR tests invalid KafkaTopic names that should FAIL validation:
     - invalid-topic-123 (wrong prefix)
     - demo-topic-test (wrong suffix)
     - demo-topic- (missing numbers)
     
     Expected Result: âŒ GitHub Actions workflow should FAIL with OPA validation errors
     ```
5. Crear Pull Request

Criterio de aceptaciÃ³n: âœ… PR creado y workflow iniciado


ðŸ”„ SUBTAREA 8.5: Validate Workflow Failure and Error Messages
-------------------------------------------------------------
ðŸ“‹ Estado: PENDING (depende de 8.4)

ðŸŽ¯ Objetivo: Verificar que el workflow FALLE correctamente

Pasos de verificaciÃ³n:
1. Ve a la pestaÃ±a "Actions" en GitHub
2. Busca el workflow run del PR reciÃ©n creado
3. Verifica que el estado sea: âŒ FAILED
4. Revisa los logs del paso "OPA Validation"
5. Confirma mensajes de error especÃ­ficos como:
   ```
   âŒ KafkaTopic name 'invalid-topic-123' is invalid: must start with 'demo-topic-'
   âŒ KafkaTopic name 'demo-topic-test' is invalid: must end with one or more digits
   âŒ KafkaTopic name 'demo-topic-' is invalid: name cannot be empty after 'demo-topic-'
   ```

Documentar:
- Screenshot del workflow fallido
- Captura de los mensajes de error especÃ­ficos
- Link al workflow run

Criterio de aceptaciÃ³n: âœ… Workflow falla con mensajes claros de error


ðŸ§¹ CLEANUP POSTERIOR:
====================
DespuÃ©s de completar todas las subtareas:

```bash
# Cerrar PR (sin mergear)
gh pr close --delete-branch

# O manualmente en GitHub, luego:
git checkout main
git branch -D feature/test-invalid-kafka-topic
git push origin --delete feature/test-invalid-kafka-topic

# Opcional: eliminar archivos de test
rm test-resources/invalid-kafka-topics.yaml
```

ðŸ“Š ACTUALIZAR TASKMASTER:
=========================
Marca las subtareas como completadas:
```bash
task-master set-status --id=8.1 --status=done
task-master set-status --id=8.2 --status=done
task-master set-status --id=8.3 --status=done
task-master set-status --id=8.4 --status=done
task-master set-status --id=8.5 --status=done
task-master set-status --id=8 --status=done
```

ðŸŽ¯ RESULTADO ESPERADO:
======================
âœ… Workflow falla correctamente con manifiestos invÃ¡lidos
âœ… Mensajes de error claros y especÃ­ficos
âœ… ValidaciÃ³n del caso negativo completada
âœ… DocumentaciÃ³n de resultados

ðŸ“… FECHA: 30 de Julio de 2025
ðŸ“ ESTADO: IN-PROGRESS
ðŸ·ï¸ TAG: master
